include ../Makefile.common

SHELL=/bin/sh

CC=gcc
LD=gcc
CFLAGS=-g -fPIC -DHDF5
INCDIR=-I$(HDF5_DIR)/include  -I$(MPI_DIR)/include -I$(MDSPLUS_DIR)/include -I$(ITM_CATALOG_DIR)/include
LIBDIR=-L$(MPI_DIR)/lib -L$(HDF5_DIR)/lib  -L$(MDSPLUS_DIR)/lib64 -L$(MDSPLUS_DIR)/lib -L$(JAVA_HOME)/jre/lib/amd64 -L$(JAVA_HOME)/jre/lib/i386 -L. -L$(ITM_CATALOG_DIR)/lib
LIBS_create= -lMdsShr -lmpi -lhdf5 -lz
LIBS=-lTreeShr -lTdiShr -lMdsShr -lXTreeShr -lCacheShr -ljava -lhdf5 -lz -lmpi


COMMON_OBJECTS=ual_low_level_f77.o ual_jni.o ual_low_level.o  ual_low_level_mdsplus.o ual_low_level_remote.o ual_catalog.o ual_low_level_hdf5.o 

all: libUALLowLevel.so pythonbinding

install: all
	cp *.so $(INSTALL)/lib
	cp ual_low_level.h $(INSTALL)/include
	python setup.py install --install-lib=$(INSTALL)/python_pk/ual

clean:
	rm -f *.o *.so *~ CreateHDF5Model ual_low_level_wrap.c ual_low_level.py
	rm -rf build

clean-src: clean
	rm -f $(INSTALL)/python_pk/ual/*

libUALLowLevel.so: $(COMMON_OBJECTS)
	$(LD) -g -o $@ -shared $(COMMON_OBJECTS) $(LIBDIR) $(LIBS)

pythonbinding: libUALLowLevel.so
	python setup.py build_ext --inplace
	python setup.py build

.c.o:
	$(CC) $(INCDIR) $(CFLAGS) -c $< 



